      tags: ["Projects"]
      summary: "项目列表"
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: "项目列表"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectListResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      tags: ["Projects"]
      summary: "创建项目"
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProjectCreateRequest"
      responses:
        "201":
          description: "创建成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/projects/stats:
    get:
      tags: ["Projects"]
      summary: "项目统计"
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: "统计信息"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectStatsResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/projects/{id}:
    get:
      tags: ["Projects"]
      summary: "获取项目"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      responses:
        "200":
          description: "项目详情"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
    patch:
      tags: ["Projects"]
      summary: "更新项目"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProjectUpdateRequest"
      responses:
        "200":
          description: "更新后的项目"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
    delete:
      tags: ["Projects"]
      summary: "删除项目"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      responses:
        "204":
          description: "删除成功"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/projects/{id}/documents:
    get:
      tags: ["ProjectDocs"]
      summary: "项目文档列表"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      responses:
        "200":
          description: "文档列表"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectDocumentListResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      tags: ["ProjectDocs"]
      summary: "创建项目文档"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProjectDocumentCreateRequest"
      responses:
        "201":
          description: "创建成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectDocumentItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/projects/{id}/documents/{docId}:
    get:
      tags: ["ProjectDocs"]
      summary: "获取项目文档"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - $ref: "#/components/parameters/DocumentId"
      responses:
        "200":
          description: "文档详情"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectDocumentItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
    patch:
      tags: ["ProjectDocs"]
      summary: "更新项目文档"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - $ref: "#/components/parameters/DocumentId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProjectDocumentUpdateRequest"
      responses:
        "200":
          description: "更新后的文档"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectDocumentItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
    delete:
      tags: ["ProjectDocs"]
      summary: "删除项目文档"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - $ref: "#/components/parameters/DocumentId"
      responses:
        "204":
          description: "删除成功"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/projects/{id}/skills:
    get:
      tags: ["ProjectSkills"]
      summary: "技能列表"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      responses:
        "200":
          description: "技能列表"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectSkillListResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      tags: ["ProjectSkills"]
      summary: "创建技能"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProjectSkillCreateRequest"
      responses:
        "201":
          description: "创建成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectSkillItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/projects/{id}/skills/{skillId}:
    patch:
      tags: ["ProjectSkills"]
      summary: "更新技能"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - $ref: "#/components/parameters/SkillId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProjectSkillUpdateRequest"
      responses:
        "200":
          description: "更新后的技能"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectSkillItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
    delete:
      tags: ["ProjectSkills"]
      summary: "删除技能"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - $ref: "#/components/parameters/SkillId"
      responses:
        "204":
          description: "删除成功"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/projects/{id}/workflows:
    get:
      tags: ["ProjectWorkflows"]
      summary: "工作流列表"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      responses:
        "200":
          description: "工作流列表"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectWorkflowListResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      tags: ["ProjectWorkflows"]
      summary: "创建工作流"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProjectWorkflowCreateRequest"
      responses:
        "201":
          description: "创建成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectWorkflowItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/projects/{id}/workflows/{workflowId}:
    patch:
      tags: ["ProjectWorkflows"]
      summary: "更新工作流"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - $ref: "#/components/parameters/WorkflowId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProjectWorkflowUpdateRequest"
      responses:
        "200":
          description: "更新后的工作流"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectWorkflowItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
    delete:
      tags: ["ProjectWorkflows"]
      summary: "删除工作流"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - $ref: "#/components/parameters/WorkflowId"
      responses:
        "204":
          description: "删除成功"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/projects/{id}/conversations:
    get:
      tags: ["Conversations"]
      summary: "项目会话列表"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      responses:
        "200":
          description: "会话列表"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConversationListResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      tags: ["Conversations"]
      summary: "创建项目会话"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ConversationCreateRequest"
      responses:
        "201":
          description: "创建成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConversationItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/conversations:
    get:
      tags: ["Conversations"]
      summary: "独立会话列表"
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: "会话列表"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConversationListResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      tags: ["Conversations"]
      summary: "创建独立会话"
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ConversationCreateRequest"
      responses:
        "201":
          description: "创建成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConversationItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/conversations/{conversationId}/messages:
    get:
      tags: ["Conversations"]
      summary: "消息列表"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ConversationId"
      responses:
        "200":
          description: "消息列表"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MessageListResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      tags: ["Conversations"]
      summary: "创建消息"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ConversationId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MessageCreateRequest"
      responses:
        "201":
          description: "创建成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MessageItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/conversations/{conversationId}:
    patch:
      tags: ["Conversations"]
      summary: "更新会话标题"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ConversationId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ConversationUpdateRequest"
      responses:
        "200":
          description: "更新后的会话"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConversationItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
    delete:
      tags: ["Conversations"]
      summary: "删除会话"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ConversationId"
      responses:
        "204":
          description: "删除成功"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/knowledge-bases:
    get:
      tags: ["Knowledge"]
      summary: "知识库列表"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - name: scope
          in: query
          description: "范围，默认 all"
          required: false
          schema:
            type: string
            example: "all"
        - name: project_id
          in: query
          description: "项目 ID"
          required: false
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: "知识库列表"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/KnowledgeBaseListResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      tags: ["Knowledge"]
      summary: "创建知识库"
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/KnowledgeBaseCreateRequest"
      responses:
        "201":
          description: "创建成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/KnowledgeBaseItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/knowledge-bases/{id}:
    get:
      tags: ["Knowledge"]
      summary: "获取知识库"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/KnowledgeBaseId"
      responses:
        "200":
          description: "知识库详情"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/KnowledgeBaseItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
    patch:
      tags: ["Knowledge"]
      summary: "更新知识库"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/KnowledgeBaseId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/KnowledgeBaseUpdateRequest"
      responses:
        "200":
          description: "更新后的知识库"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/KnowledgeBaseItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
    delete:
      tags: ["Knowledge"]
      summary: "删除知识库"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/KnowledgeBaseId"
      responses:
        "200":
          description: "删除成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatusDeletedResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/knowledge-bases/{id}/documents:
    get:
      tags: ["Knowledge"]
      summary: "知识库文档列表"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/KnowledgeBaseId"
      responses:
        "200":
          description: "文档列表"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/KnowledgeDocumentListResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      tags: ["Knowledge"]
      summary: "上传知识库文档"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/KnowledgeBaseId"
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: ["file"]
              properties:
                file:
                  type: string
                  format: binary
      responses:
        "201":
          description: "上传成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/KnowledgeDocumentItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "413":
          description: "文件过大"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/knowledge-bases/{id}/documents/{docId}:
    delete:
      tags: ["Knowledge"]
      summary: "删除知识库文档"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/KnowledgeBaseId"
        - $ref: "#/components/parameters/KnowledgeDocumentId"
      responses:
        "200":
          description: "删除成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatusDeletedResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/knowledge-bases/{id}/documents/{docId}/download:
    get:
      tags: ["Knowledge"]
      summary: "下载知识库文档"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/KnowledgeBaseId"
        - $ref: "#/components/parameters/KnowledgeDocumentId"
        - name: disposition
          in: query
          description: "inline 或 attachment，默认 attachment"
          required: false
          schema:
            type: string
            enum: ["inline", "attachment"]
      responses:
        "200":
          description: "文件内容"
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/billing/hold:
    post:
      tags: ["Billing"]
      summary: "冻结额度"
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BillingRequest"
      responses:
        "200":
          description: "冻结成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BillingHoldResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "402":
          $ref: "#/components/responses/PaymentRequired"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/billing/capture:
    post:
      tags: ["Billing"]
      summary: "扣减冻结额度"
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BillingRequest"
      responses:
        "200":
          description: "扣减成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BillingHoldResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "402":
          $ref: "#/components/responses/PaymentRequired"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/billing/release:
    post:
      tags: ["Billing"]
      summary: "释放冻结额度"
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BillingRequest"
      responses:
        "200":
          description: "释放成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BillingHoldResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "402":
          $ref: "#/components/responses/PaymentRequired"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/billing/wallet:
    get:
      tags: ["Billing"]
      summary: "钱包与 24h 用量"
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: "钱包信息"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BillingWalletResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/billing/usage:
    get:
      tags: ["Billing"]
      summary: "用量列表"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
        - name: start
          in: query
          description: "起始时间 (RFC3339)"
          required: false
          schema:
            type: string
            format: date-time
        - name: end
          in: query
          description: "结束时间 (RFC3339)"
          required: false
          schema:
            type: string
            format: date-time
      responses:
        "200":
          description: "用量列表"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UsageListResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/users/me:
    get:
      tags: ["Users"]
      summary: "获取当前用户"
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: "用户信息"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserMeResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
    patch:
      tags: ["Users"]
      summary: "更新当前用户"
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserUpdateRequest"
      responses:
        "200":
          description: "更新成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserMeResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/users/me/password:
    post:
      tags: ["Users"]
      summary: "修改密码"
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChangePasswordRequest"
      responses:
        "200":
          description: "修改成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatusOkResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/email/send:
    post:
      tags: ["Email"]
      summary: "发送单封邮件"
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EmailSendRequest"
      responses:
        "200":
          description: "发送成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatusOkResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/email/enqueue:
    post:
      tags: ["Email"]
      summary: "批量入队邮件"
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EmailEnqueueRequest"
      responses:
        "200":
          description: "入队成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EmailEnqueueResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/models:
    get:
      tags: ["Models"]
      summary: "模型列表"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - name: provider
          in: query
          description: "提供商过滤"
          required: false
          schema:
            type: string
      responses:
        "200":
          description: "模型列表"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ModelListResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/models/providers:
    get:
      tags: ["Models"]
      summary: "模型提供商列表"
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: "提供商列表"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ModelProviderListResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/admin/models/sync:
    post:
      tags: ["Admin"]
      summary: "管理员：同步上游模型"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: "同步成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ModelSyncResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/admin/models/confirm:
    post:
      tags: ["Admin"]
      summary: "管理员：确认同步入库"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModelConfirmRequest"
      responses:
        "200":
          description: "入库成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ModelConfirmResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/admin/models/pricing:
    post:
      tags: ["Admin"]
      summary: "管理员：批量定价"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModelPricingRequest"
      responses:
        "200":
          description: "更新成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ModelPricingResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/admin/models:
    get:
      tags: ["Admin"]
      summary: "管理员：模型列表"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - name: provider
          in: query
          description: "提供商过滤"
          required: false
          schema:
            type: string
      responses:
        "200":
          description: "模型列表"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ModelListResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      tags: ["Admin"]
      summary: "管理员：创建模型"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModelCreateRequest"
      responses:
        "201":
          description: "创建成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ModelItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/admin/models/providers:
    get:
      tags: ["Admin"]
      summary: "管理员：模型提供商列表"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: "提供商列表"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ModelProviderListResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/admin/plans:
    get:
      tags: ["Admin"]
      summary: "管理员：套餐列表"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: "套餐列表"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PlanListResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      tags: ["Admin"]
      summary: "管理员：创建套餐"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PlanCreateRequest"
      responses:
        "201":
          description: "创建成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PlanItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/admin/plans/{id}:
    patch:
      tags: ["Admin"]
      summary: "管理员：更新套餐"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/PlanId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PlanUpdateRequest"
      responses:
        "200":
          description: "更新成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PlanItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/admin/subscriptions:
    post:
      tags: ["Admin"]
      summary: "管理员：创建订阅"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PlanSubscriptionCreateRequest"
      responses:
        "201":
          description: "创建成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PlanSubscriptionItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/admin/subscriptions/{id}:
    patch:
      tags: ["Admin"]
      summary: "管理员：更新订阅"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/PlanSubscriptionId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PlanSubscriptionUpdateRequest"
      responses:
        "200":
          description: "更新成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PlanSubscriptionItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/admin/users/{id}/subscription:
    get:
      tags: ["Admin"]
      summary: "管理员：获取用户生效订阅"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/UserId"
      responses:
        "200":
          description: "订阅信息"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PlanSubscriptionItem"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/admin/models/{id}:
    patch:
      tags: ["Admin"]
      summary: "管理员：更新模型"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ModelId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModelUpdateRequest"
      responses:
        "200":
          description: "更新成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ModelItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/admin/users:
    get:
      tags: ["Admin"]
      summary: "管理员：用户列表"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
        - name: search
          in: query
          description: "搜索关键字"
          required: false
          schema:
            type: string
        - name: role
          in: query
          description: "角色过滤"
          required: false
          schema:
            type: string
        - name: status
          in: query
          description: "状态过滤"
          required: false
          schema:
            type: string
      responses:
        "200":
          description: "用户列表"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminUserListResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      tags: ["Admin"]
      summary: "管理员：创建用户"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AdminUserCreateRequest"
      responses:
        "201":
          description: "创建成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserModel"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/admin/users/{id}:
    get:
      tags: ["Admin"]
      summary: "管理员：获取用户"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/UserId"
      responses:
        "200":
          description: "用户信息"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserMeResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
    patch:
      tags: ["Admin"]
      summary: "管理员：更新用户"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/UserId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AdminUserUpdateRequest"
      responses:
        "200":
          description: "更新成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatusOkResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
    delete:
      tags: ["Admin"]
      summary: "管理员：删除用户"
      description: "需要管理员权限"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/UserId"
      responses:
        "200":
          description: "删除成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatusOkResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalError"
  /v1/{path}:
    get:
      tags: ["Proxy"]
      summary: "代理 NewAPI"
      description: "转发到 NewAPI，路径与参数保持一致。"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProxyPath"
        - $ref: "#/components/parameters/BillingAmount"
        - $ref: "#/components/parameters/BillingRefId"
      responses:
        "200":
          description: "透传响应"
    post:
      tags: ["Proxy"]
      summary: "代理 NewAPI"
      description: "转发到 NewAPI，路径与参数保持一致。"
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProxyPath"
        - $ref: "#/components/parameters/BillingAmount"
        - $ref: "#/components/parameters/BillingRefId"
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              description: "透传请求体"
      responses:
        "200":
          description: "透传响应"
components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: ds_session
      description: "登录态 Cookie（名称以实际配置为准）"
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    ProjectId:
      name: id
      in: path
      required: true
      schema:
        type: integer
        format: int64
    DocumentId:
      name: docId
      in: path
      required: true
      schema:
        type: integer
        format: int64
    SkillId:
      name: skillId
      in: path
      required: true
      schema:
        type: integer
        format: int64
    WorkflowId:
      name: workflowId
      in: path
      required: true
      schema:
        type: integer
        format: int64
    ConversationId:
      name: conversationId
      in: path
      required: true
      schema:
        type: integer
        format: int64
    KnowledgeBaseId:
      name: id
      in: path
      required: true
      schema:
        type: integer
        format: int64
    KnowledgeDocumentId:
      name: docId
      in: path
      required: true
      schema:
        type: integer
        format: int64
    UserId:
      name: id
      in: path
      required: true
      schema:
        type: integer
        format: int64
    PlanId:
      name: id
      in: path
      required: true
      schema:
        type: integer
        format: int64
    PlanSubscriptionId:
      name: id
      in: path
      required: true
      schema:
        type: integer
        format: int64
    ModelId:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
    Page:
      name: page
      in: query
      required: false
      schema:
        type: integer
        default: 1
    PageSize:
      name: page_size
      in: query
      required: false
      schema:
        type: integer
        default: 20
    ProxyPath:
      name: path
      in: path
      required: true
      description: "代理路径（不含 /v1 前缀）"
      schema:
        type: string
    BillingAmount:
      name: X-Billing-Amount
      in: header
      required: false
      description: "计费金额"
      schema:
        type: number
        format: double
    BillingRefId:
      name: X-Billing-Ref-Id
      in: header
      required: false
      description: "计费引用 ID"
      schema:
        type: string
  responses:
    BadRequest:
      description: "请求参数错误"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Unauthorized:
      description: "未授权"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Forbidden:
      description: "权限不足"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    NotFound:
      description: "资源不存在"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Conflict:
      description: "资源冲突"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    PaymentRequired:
      description: "余额不足"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    InternalError:
      description: "服务内部错误"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
  schemas:
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: "ok"
    StatusOkResponse:
      type: object
      properties:
        status:
          type: string
          example: "ok"
    StatusDeletedResponse:
      type: object
      properties:
        status:
          type: string
          example: "deleted"
    ErrorResponse:
      type: object
      description: "错误响应（可能为字符串或对象，此处统一为对象）"
      properties:
        error:
          oneOf:
            - type: string
            - $ref: "#/components/schemas/ErrorDetail"
    ErrorDetail:
      type: object
      properties:
        message:
          type: string
        type:
          type: string
        trace_id:
          type: string
    AuthRegisterRequest:
      type: object
      required: ["email", "password"]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
    AuthLoginRequest:
      type: object
      required: ["email", "password"]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
    AuthLoginResponse:
      type: object
      properties:
        user_id:
          type: integer
          format: int64
    AuthMeResponse:
      type: object
      properties:
        user_id:
          type: integer
          format: int64
    ProjectItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        type:
          type: string
        description:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    ProjectListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ProjectItem"
    ProjectStatsResponse:
      type: object
      properties:
        projects:
          type: integer
        literature:
          type: integer
        workflows:
          type: integer
        agents:
          type: integer
    ProjectCreateRequest:
      type: object
      required: ["name", "type"]
      properties:
        name:
          type: string
        description:
          type: string
          nullable: true
        type:
          type: string
          description: "research 或 agent"
    ProjectUpdateRequest:
      type: object
      properties:
        name:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
    ProjectDocumentItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
        project_id:
          type: integer
          format: int64
        title:
          type: string
        content:
          type: string
        tags:
          type: array
          items:
            type: string
        status:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    ProjectDocumentListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ProjectDocumentItem"
    ProjectDocumentCreateRequest:
      type: object
      required: ["title", "content", "tags"]
      properties:
        title:
          type: string
        content:
          type: string
        tags:
          type: array
          items:
            type: string
    ProjectDocumentUpdateRequest:
      type: object
      properties:
        title:
          type: string
          nullable: true
        content:
          type: string
          nullable: true
        tags:
          type: array
          items:
            type: string
          nullable: true
    ProjectSkillItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
        user_id:
          type: integer
          format: int64
        project_id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
          nullable: true
        prompt:
          type: string
          nullable: true
        created_at:
          type: string
        updated_at:
          type: string
    ProjectSkillListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ProjectSkillItem"
    ProjectSkillCreateRequest:
      type: object
      required: ["name"]
      properties:
        name:
          type: string
        description:
          type: string
          nullable: true
        prompt:
          type: string
          nullable: true
    ProjectSkillUpdateRequest:
      type: object
      properties:
        name:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        prompt:
          type: string
          nullable: true
    ProjectWorkflowItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
        user_id:
          type: integer
          format: int64
        project_id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
          nullable: true
        steps:
          type: object
          description: "JSON 步骤定义"
        created_at:
          type: string
        updated_at:
          type: string
    ProjectWorkflowListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ProjectWorkflowItem"
    ProjectWorkflowCreateRequest:
      type: object
      required: ["name", "steps"]
      properties:
        name:
          type: string
        description:
          type: string
          nullable: true
        steps:
          type: object
    ProjectWorkflowUpdateRequest:
      type: object
      properties:
        name:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        steps:
          type: object
          nullable: true
    ConversationItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
        project_id:
          type: integer
          format: int64
          nullable: true
        title:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    ConversationListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ConversationItem"
    ConversationCreateRequest:
      type: object
      properties:
        title:
          type: string
          nullable: true
    ConversationUpdateRequest:
      type: object
      required: ["title"]
      properties:
        title:
          type: string
    MessageItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
        conversation_id:
          type: integer
          format: int64
        role:
          type: string
        content:
          type: string
        model:
          type: string
          nullable: true
        trace_id:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
    MessageListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/MessageItem"
    MessageCreateRequest:
      type: object
      required: ["content"]
      properties:
        role:
          type: string
        content:
          type: string
        model:
          type: string
          nullable: true
        trace_id:
          type: string
          nullable: true
    KnowledgeBaseItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
        user_id:
          type: integer
          format: int64
        project_id:
          type: integer
          format: int64
          nullable: true
        scope:
          type: string
        name:
          type: string
        description:
          type: string
          nullable: true
        doc_count:
          type: integer
        created_at:
          type: string
        updated_at:
          type: string
    KnowledgeBaseListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/KnowledgeBaseItem"
    KnowledgeBaseCreateRequest:
      type: object
      required: ["name", "scope"]
      properties:
        name:
          type: string
        description:
          type: string
          nullable: true
        scope:
          type: string
          description: "project"
        project_id:
          type: integer
          format: int64
          nullable: true
    KnowledgeBaseUpdateRequest:
      type: object
      properties:
        name:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
    KnowledgeDocumentItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
        knowledge_base_id:
          type: integer
          format: int64
        user_id:
          type: integer
          format: int64
        project_id:
          type: integer
          format: int64
          nullable: true
        file_name:
          type: string
        content_type:
          type: string
          nullable: true
        size_bytes:
          type: integer
          format: int64
          nullable: true
        storage_path:
          type: string
        status:
          type: string
        created_at:
          type: string
        updated_at:
          type: string
    KnowledgeDocumentListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/KnowledgeDocumentItem"
    BillingRequest:
      type: object
      required: ["amount", "ref_id"]
      properties:
        amount:
          type: number
          format: double
        ref_id:
          type: string
        metadata:
          type: object
          additionalProperties: true
    BillingHoldResponse:
      type: object
      properties:
        wallet:
          $ref: "#/components/schemas/Wallet"
        transaction:
          $ref: "#/components/schemas/Transaction"
    BillingWalletResponse:
      type: object
      properties:
        wallet:
          $ref: "#/components/schemas/Wallet"
        usage_24h:
          type: number
          format: double
    Wallet:
      type: object
      properties:
        user_id:
          type: integer
          format: int64
        balance:
          type: number
          format: double
        frozen_balance:
          type: number
          format: double
        updated_at:
          type: string
          format: date-time
    Transaction:
      type: object
      properties:
        id:
          type: integer
          format: int64
        user_id:
          type: integer
          format: int64
        type:
          type: string
        amount:
          type: number
          format: double
        ref_id:
          type: string
        metadata:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time
    UsageRecord:
      type: object
      properties:
        id:
          type: integer
          format: int64
        user_id:
          type: integer
          format: int64
        project_id:
          type: integer
          format: int64
          nullable: true
        model:
          type: string
        prompt_tokens:
          type: integer
        completion_tokens:
          type: integer
        total_tokens:
          type: integer
        cost:
          type: number
          format: double
        trace_id:
          type: string
        created_at:
          type: string
          format: date-time
    UsageListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/UsageRecord"
        page:
          type: integer
        page_size:
          type: integer
        total:
          type: integer
    UserModel:
      type: object
      properties:
        id:
          type: integer
          format: int64
        email:
          type: string
        status:
          type: string
        role:
          type: string
        last_login_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
    UserProfile:
      type: object
      properties:
        user_id:
          type: integer
          format: int64
        display_name:
          type: string
          nullable: true
        full_name:
          type: string
          nullable: true
        title:
          type: string
          nullable: true
        avatar_url:
          type: string
          nullable: true
        bio:
          type: string
          nullable: true
        phone:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    UserSettings:
      type: object
      properties:
        user_id:
          type: integer
          format: int64
        theme:
          type: string
        locale:
          type: string
        timezone:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    UserMeResponse:
      type: object
      properties:
        user:
          $ref: "#/components/schemas/UserModel"
        profile:
          $ref: "#/components/schemas/UserProfile"
        settings:
          $ref: "#/components/schemas/UserSettings"
    UserUpdateRequest:
      type: object
      properties:
        profile:
          $ref: "#/components/schemas/UserProfileUpdate"
        settings:
          $ref: "#/components/schemas/UserSettingsUpdate"
    UserProfileUpdate:
      type: object
      properties:
        display_name:
          type: string
          nullable: true
        full_name:
          type: string
          nullable: true
        title:
          type: string
          nullable: true
        avatar_url:
          type: string
          nullable: true
        bio:
          type: string
          nullable: true
        phone:
          type: string
          nullable: true
    UserSettingsUpdate:
      type: object
      properties:
        theme:
          type: string
          nullable: true
        locale:
          type: string
          nullable: true
        timezone:
          type: string
          nullable: true
    EmailSendRequest:
      type: object
      required: ["type", "to", "subject"]
      properties:
        type:
          type: string
          enum: ["welcome", "reset_password"]
          description: "邮件类型，必须为固定值"
        to:
          type: array
          items:
            type: string
        subject:
          type: string
        html_template:
          type: string
          nullable: true
          description: "不允许传入，会根据 type 自动选择模板"
        template_data:
          type: object
          additionalProperties: true
        html:
          type: string
          nullable: true
          description: "不允许传入，会根据 type 自动渲染"
        text:
          type: string
          nullable: true
        reply_to:
          type: string
          nullable: true
        headers:
          type: object
          additionalProperties:
            type: string
    EmailEnqueueRequest:
      type: object
      required: ["items"]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/EmailSendRequest"
    EmailEnqueueResponse:
      type: object
      properties:
        status:
          type: string
          example: "ok"
        count:
          type: integer
    ModelItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        provider:
          type: string
        price_input:
          type: number
          format: double
        price_output:
          type: number
          format: double
        currency:
          type: string
        capabilities:
          type: array
          items:
            type: string
          description: "能力列表，可选值：chat=对话，completion=补全，embedding=向量，vision=视觉，image=图像，audio=音频，tool=工具，skill=技能，stream=流式，json_mode=JSON模式，function_call=函数调用"
        status:
          type: string
        metadata:
          type: object
          additionalProperties: true
        created_at:
          type: string
        updated_at:
          type: string
    ModelListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ModelItem"
    ModelProviderListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            type: string
    ModelCreateRequest:
      type: object
      required: ["name", "provider"]
      properties:
        name:
          type: string
        provider:
          type: string
        price_input:
          type: number
          format: double
        price_output:
          type: number
          format: double
        currency:
          type: string
        capabilities:
          type: array
          items:
            type: string
          description: "能力列表，可选值：chat=对话，completion=补全，embedding=向量，vision=视觉，image=图像，audio=音频，tool=工具，skill=技能，stream=流式，json_mode=JSON模式，function_call=函数调用"
        status:
          type: string
        metadata:
          type: object
          additionalProperties: true
    ModelUpdateRequest:
      type: object
      properties:
        provider:
          type: string
          nullable: true
        price_input:
          type: number
          format: double
          nullable: true
        price_output:
          type: number
          format: double
          nullable: true
        currency:
          type: string
          nullable: true
        capabilities:
          type: array
          items:
            type: string
          nullable: true
          description: "能力列表，可选值：chat=对话，completion=补全，embedding=向量，vision=视觉，image=图像，audio=音频，tool=工具，skill=技能，stream=流式，json_mode=JSON模式，function_call=函数调用"
        status:
          type: string
          nullable: true
        provider_icon:
          type: string
          nullable: true
          description: "提供商图标（Base64 字符串）"
        metadata:
          type: object
          additionalProperties: true
          nullable: true
    ModelConfirmItem:
      type: object
      required: ["name", "provider"]
      properties:
        name:
          type: string
        provider:
          type: string
    ModelConfirmRequest:
      type: object
      required: ["items"]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ModelConfirmItem"
    ModelConfirmResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ModelItem"
        created:
          type: integer
        updated:
          type: integer
    ModelPricingItem:
      type: object
      required: ["id"]
      properties:
        id:
          type: string
          format: uuid
        price_input:
          type: number
          format: double
          nullable: true
        price_output:
          type: number
          format: double
          nullable: true
        currency:
          type: string
          nullable: true
        status:
          type: string
          nullable: true
        capabilities:
          type: array
          items:
            type: string
          nullable: true
          description: "能力列表，可选值：chat=对话，completion=补全，embedding=向量，vision=视觉，image=图像，audio=音频，tool=工具，skill=技能，stream=流式，json_mode=JSON模式，function_call=函数调用"
    ModelPricingRequest:
      type: object
      required: ["items"]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ModelPricingItem"
    ModelPricingResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ModelItem"
        missed_ids:
          type: array
          items:
            type: string
    UpstreamModel:
      type: object
      properties:
        name:
          type: string
        provider:
          type: string
    ModelSyncResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/UpstreamModel"
    PlanItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        status:
          type: string
          description: "状态，可选值：active=生效，disabled=停用，expired=过期，canceled=取消"
        currency:
          type: string
        billing_mode:
          type: string
          description: "计费模式，可选值：token=按Token，request=按请求"
        price_input:
          type: number
          format: double
        price_output:
          type: number
          format: double
        price_request:
          type: number
          format: double
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    PlanListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/PlanItem"
    PlanCreateRequest:
      type: object
      required: ["name", "billing_mode"]
      properties:
        name:
          type: string
        status:
          type: string
          description: "状态，可选值：active=生效，disabled=停用，expired=过期，canceled=取消"
        currency:
          type: string
        billing_mode:
          type: string
          description: "计费模式，可选值：token=按Token，request=按请求"
        price_input:
          type: number
          format: double
        price_output:
          type: number
          format: double
        price_request:
          type: number
          format: double
    PlanUpdateRequest:
      type: object
      properties:
        name:
          type: string
          nullable: true
        status:
          type: string
          nullable: true
          description: "状态，可选值：active=生效，disabled=停用，expired=过期，canceled=取消"
        currency:
          type: string
          nullable: true
        billing_mode:
          type: string
          nullable: true
          description: "计费模式，可选值：token=按Token，request=按请求"
        price_input:
          type: number
          format: double
          nullable: true
        price_output:
          type: number
          format: double
          nullable: true
        price_request:
          type: number
          format: double
          nullable: true
    PlanSubscriptionItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
        user_id:
          type: integer
          format: int64
        plan_id:
          type: integer
          format: int64
        status:
          type: string
          description: "状态，可选值：active=生效，disabled=停用，expired=过期，canceled=取消"
        start_at:
          type: string
          format: date-time
        end_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    PlanSubscriptionCreateRequest:
      type: object
      required: ["user_id", "plan_id", "start_at"]
      properties:
        user_id:
          type: integer
          format: int64
        plan_id:
          type: integer
          format: int64
        status:
          type: string
          description: "状态，可选值：active=生效，disabled=停用，expired=过期，canceled=取消"
        start_at:
          type: string
          format: date-time
        end_at:
          type: string
          format: date-time
          nullable: true
    PlanSubscriptionUpdateRequest:
      type: object
      properties:
        status:
          type: string
          nullable: true
          description: "状态，可选值：active=生效，disabled=停用，expired=过期，canceled=取消"
        start_at:
          type: string
          format: date-time
          nullable: true
        end_at:
          type: string
          format: date-time
          nullable: true
    ChangePasswordRequest:
      type: object
      required: ["old_password", "new_password"]
      properties:
        old_password:
          type: string
        new_password:
          type: string
          minLength: 8
    AdminUserListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/AdminUserListItem"
        page:
          type: integer
        page_size:
          type: integer
        total:
          type: integer
    AdminUserListItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
        email:
          type: string
        username:
          type: string
        status:
          type: string
        role:
          type: string
        last_login_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
    AdminUserCreateRequest:
      type: object
      required: ["email", "password"]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
        role:
          type: string
        status:
          type: string
        profile:
          $ref: "#/components/schemas/UserProfileUpdate"
        settings:
          $ref: "#/components/schemas/UserSettingsUpdate"
    AdminUserUpdateRequest:
      type: object
      properties:
        email:
          type: string
        password:
          type: string
        role:
          type: string
        status:
          type: string
        profile:
          $ref: "#/components/schemas/UserProfileUpdate"
        settings:
          $ref: "#/components/schemas/UserSettingsUpdate"
